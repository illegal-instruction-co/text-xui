<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <style>
      body {
        background: transparent;
        overflow: hidden;
      }
      .esp-box {
        position: absolute;
        border: 2px dotted rgb(255, 165, 0, .5);
        border-left: none;
        height: 300px;
        width: 150px;
        top: 50vh;
        left: 50vw;
        transform: scale(1.9);
      }
      .esp-box .health-bar {
        height: 100%;
        background: rgb(60, 60, 60, 0.5);
        width: 5px;
      }
      .esp-box .health-bar .plus{
        height: 60%;
        background: rgb(60, 179, 113, 0.5);
        width: 5px;
      }
      .esp-box .health-bar .minus{
        height: 40%;
        background: rgb(255, 0, 0, 0.5);
        width: 5px;
      }
      .line {
        border-top: 1px dotted rgb(255, 165, 0, .5);
        position: absolute;
        top: 9%;
        left: 23%;
        width: 50vh;
        transform: skewY(-40deg);
      }
    </style>
  </head>
  <body>
    <div id="box-container">
    </div>
    <script>

    var boxes = []

    function AddBox(id) {
      var theBox = document.getElementById("box-container");
      var newBox = document.createElement('div')
      newBox.setAttribute("id", id)
      newBox.innerHTML = '';
      theBox.appendChild(newBox);
      var espBox = document.createElement('div')
      espBox.setAttribute("id", `${id} esp-box`)
      espBox.classList.add("esp-box")
      espBox.innerHTML = '';
      document.getElementById(id).appendChild(espBox);
      var healthBar = document.createElement('div')
      healthBar.setAttribute("id", `${id} health-bar`)
      healthBar.classList.add("health-bar")
      healthBar.innerHTML = '';
      document.getElementById(`${id} esp-box`).appendChild(healthBar);
      var plus = document.createElement('div')
      plus.setAttribute("id", `${id} plus`)
      plus.classList.add("plus")
      plus.innerHTML = '';
      document.getElementById(`${id} health-bar`).appendChild(plus);
      var minus = document.createElement('div')
      minus.setAttribute("id", `${id} minus`)
      minus.classList.add("minus")
      minus.innerHTML = '';
      document.getElementById(`${id} health-bar`).appendChild(minus);
      boxes.push({id: id})
    }
    function DeleteBox(id) {
      document.getElementById(id).remove()
      boxes = boxes.filter(function(item) {
          return item !== id
      })

    }
    function ChangeHealth(id, health, maxHealth) {
      var plus = health / (maxHealth / 100)
      var minus = (maxHealth - health) / (maxHealth / 100)
      document.getElementById(`${id} plus`).style.height = `${plus}%`
      document.getElementById(`${id} minus`).style.height = `${minus}%`
    }
    function ChangeBoxPos(id,x,y) {
      document.getElementById(`${id} esp-box`).style.left = `${x}px`
      document.getElementById(`${id} esp-box`).style.top = `${y}px`
    }
    function ChangeBoxSize(id, size) {
      document.getElementById("esp-box").style.transform = `scale(${size})`
    }
    OnXuiMessage = function(message) {
      message = JSON.parse(message)
      if(message.command === "change") {
        let box = boxes.find(o => o.id === message.id)
        if(box === undefined) {
          AddBox(message.id)
        } else {
          if(message.x < 0 || message.y < 0) {
            DeleteBox(message.id)
          }
        }
        ChangeBoxPos(message.id, message.x, message.y)
        ChangeHealth(message.id, message.health, message.maxHealth)
      }
    }

    </script>
  </body>
</html>
